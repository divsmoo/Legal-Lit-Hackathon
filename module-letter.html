<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Module: Draft a Legal Letter • Legal AI Coach</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <a class="skip-link" href="#main">Skip to content</a>

  <header class="site-header">
    <nav class="nav">
      <a class="brand" href="index.html"><span class="big-brand" style="font-size: 48px; font-weight:700;">JuriSight</span></a>
      <div style="font-size: 20px; color:#374151; margin-top:4px;">AI is a tool, judgement is yours</div>
    </nav>

    <section class="hero hero-small">
      <h1>Using AI to Draft a Legal Letter</h1>
      <p>Review an AI-generated tenancy termination letter and find the issue.</p>
    </section>
  </header>

  <main id="main" class="container">
    <section class="card">
      <h2>Prompt used</h2>
      <pre class="pre small" aria-label="Prompt example">
Draft a tenancy termination letter for a residential lease in Singapore.
Cite only current and applicable statutes or the relevant contract clause.
Avoid including or revealing any personal identifiers (names, NRIC/FIN, email, phone, unit numbers).
      </pre>
    </section>

    <section class="card">
      <h2>AI-Generated Letter</h2>
      <pre class="pre" id="letterOutput" aria-live="polite">
Dear Sir/Madam,

To: Ms Lim Mei Yun (NRIC: S1234567A), 12-34 Sunrise Residences, #10-08, Singapore 567890
Email: lim.meiyun@example.com | Phone: +65 9123 4567

This letter gives notice that your tenancy is terminated with effect from 1 October 2025.
Pursuant to the Landlord and Tenant Act (Cap. 158, 1954), Section 34(2), the landlord guarantees vacant possession on that date without exception.

Kindly hand over the keys by 5:00 PM on 1 October 2025.

Sincerely,
Landlord
      </pre>

      <details class="hint">
        <summary>Need a hint?</summary>
        Watch for (1) unredacted PII, (2) outdated or wrong-jurisdiction statutes, and (3) overly definitive promises such as “guarantees” or “without exception.”
      </details>
    </section>

    <section class="card">
      <h2>What mistake did the AI most likely make?</h2>
      <div class="progress-row" id="letterProgressRow" aria-live="polite">
        <span id="letterProgressText">Question 1 of 6</span>
        <div id="letterProgressBar" style="height:8px;border-radius:4px;background:#eceff3;margin-top:8px;">
          <div id="letterProgressFill" style="height:8px;border-radius:4px;width:0%;background:#6172f3;"></div>
        </div>
      </div>
      <!-- MCQ: only one correct answer -->
      <form class="mcq" data-module="letter" aria-label="Multiple choice question: pick one">
        <label class="mcq-option">
          <input type="radio" name="q1" value="A" />
          A) It cited the correct and current statute with precise section numbers.
        </label>
        <label class="mcq-option">
          <input type="radio" name="q1" value="B" />
          B) It revealed confidential personal identifiers (NRIC, unit, email, phone) that should have been redacted.
        </label>
        <label class="mcq-option">
          <input type="radio" name="q1" value="C" />
          C) It used cautious, qualified language avoiding guarantees.
        </label>
        <label class="mcq-option">
          <input type="radio" name="q1" value="D" />
          D) It relied on up‑to-date Singapore tenancy law without errors.
        </label>

        <div class="actions">
          <button class="btn" type="submit">Check Answer</button>
          <button class="btn btn-secondary" type="button" data-show-analysis>Show Risk Coaching</button>
          <button class="btn btn-tertiary" type="button" id="nextQuestionBtn" aria-controls="main">Next Question ▶</button>
        </div>
      </form>

      <div class="feedback" id="letterFeedback" role="status" aria-live="polite"></div>

      <div class="grid-3" id="letterRisk" hidden>
        <div class="panel">
          <h3>Overall Risk <span class="badge" id="letterBadge">–</span></h3>
          <ul class="list" id="letterRiskSummary"></ul>
        </div>
        <div class="panel">
          <h3>Confidentiality</h3>
          <ul class="list" id="letterPII"></ul>
        </div>
        <div class="panel">
          <h3>Hallucination / Currency</h3>
          <ul class="list" id="letterHallucination"></ul>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Learning points</h2>
      <ul class="bullets">
        <li><strong>Confidentiality:</strong> <em>Redact PII</em> (NRIC/FIN, full address/unit, phone, email) in letters and attachments.</li>
        <li><strong>Correct authority:</strong> Prefer <em>Singapore</em> statutes/cases. Do not treat <em>foreign</em> law as binding unless applicable.</li>
        <li><strong>Currency:</strong> Ensure the statute/case is <em>current</em>; avoid citing expired temporary provisions.</li>
        <li><strong>No guarantees:</strong> Avoid absolutes like “guarantees,” “automatic,” or “will obtain.” Use qualified language (e.g., “may,” “subject to court discretion/contract”).</li>
        <li><strong>Existence check:</strong> Verify that any <em>statute section</em> or <em>contract clause</em> you cite actually exists and is correctly numbered/titled.</li>
        <li><strong>“Latest authority” claims:</strong> If you assert “latest,” confirm the <em>date</em> and <em>court level</em> (SGCA outranks SGHC).</li>
        <li><strong>Remedies are conditional:</strong> Possession orders, damages, and deposit forfeiture are <em>fact- and contract-dependent</em> and require legal process.</li>
        <li><strong>Specificity:</strong> Prefer the actual <em>contract clause</em> when relevant; otherwise cite the precise statute/section instead of “as per the law.”</li>
      </ul>
    </section>
  </main>

  <footer class="site-footer">
    <p>Educational prototype. Not legal advice. Consult a qualified lawyer.</p>
  </footer>

</body>
  <script src="scripts/app.js" defer></script>
  <script>
  (function () {
    // Cache DOM nodes (keep original IDs so existing scripts keep working)
    const promptPre = document.querySelector('section.card h2 + pre.pre.small');
    const letterPre  = document.getElementById('letterOutput');
    const hintDetails = document.querySelector('section.card details.hint');
    const hintSummary = hintDetails ? hintDetails.querySelector('summary') : null;
    const feedback = document.getElementById('letterFeedback');
    const risk = document.getElementById('letterRisk');
    const badgeEl = document.getElementById('letterBadge');
    const riskSummaryList = document.getElementById('letterRiskSummary');
    const piiList = document.getElementById('letterPII');
    const hallucinationList = document.getElementById('letterHallucination');
    const form = document.querySelector('form.mcq[data-module="letter"]');
    const options = Array.from(form.querySelectorAll('.mcq-option'));
    const nextBtn = document.getElementById('nextQuestionBtn');
    // Grab the heading element for the MCQ card
    const questionHeading = form ? form.closest('section.card').querySelector('h2') : null;
    // Progress bar and counter elements
    const progressText = document.getElementById('letterProgressText');
    const progressFill = document.getElementById('letterProgressFill');

    // Define scenarios (focus: factual inaccuracies, outdated refs, over-definitive statements, PII exposure)
    const scenarios = [
      // 1) PII exposure (Correct: B)
      {
        prompt: [
          'Draft a tenancy termination letter for a residential lease in Singapore.',
          'Cite only current and applicable statutes or the relevant contract clause.',
          'Avoid including or revealing any personal identifiers (names, NRIC/FIN, email, phone, unit numbers).'
        ].join('\n'),
        letter: [
          'Dear Sir/Madam,',
          '',
          'To: Ms Lim Mei Yun (NRIC: S1234567A), 12-34 Sunrise Residences, #10-08, Singapore 567890',
          'Email: lim.meiyun@example.com | Phone: +65 9123 4567',
          '',
          'This letter gives notice that your tenancy is terminated with effect from 1 October 2025.',
          'Pursuant to the Landlord and Tenant Act (Cap. 158, 1954), Section 34(2), the landlord guarantees vacant possession on that date without exception.',
          '',
          'Kindly hand over the keys by 5:00 PM on 1 October 2025.',
          '',
          'Sincerely,',
          'Landlord'
        ].join('\n'),
        hint: 'Watch for (1) unredacted PII, (2) outdated or wrong-jurisdiction statutes, and (3) overly definitive promises.',
        options: [
          'A) It cited the correct and current statute with precise section numbers.',
          'B) It revealed confidential personal identifiers (NRIC, unit, email, phone) that should have been redacted.',
          'C) It used cautious, qualified language avoiding guarantees.',
          'D) It relied on up‑to-date Singapore tenancy law without errors.'
        ],
        correct: 'B',
        question: 'What mistake did the AI most likely make?',
        risks: {
          badge: 'High',
          summary: [
            'Unredacted PII exposed (NRIC; identity risk).',
            'Over‑definitive promise (“without exception”).',
            'References potentially outdated/wrong‑jurisdiction statute.'
          ],
          pii: [
            'Remove NRIC; use redacted placeholder.',
            'Avoid listing unit/address, phone, email unless necessary/consented.'
          ],
          hallucination: [
            'Verify statute title/section and current force in Singapore.',
            'Use contract clause if statute is inapplicable.'
          ]
        }
      },
      // 2) Hallucinated/incorrect statute (Correct: D)
      {
        prompt: [
          'Draft an eviction notice for rental arrears in Singapore.',
          'Cite either the correct contract clause or applicable Singapore law.',
          'Do not include personal identifiers; keep the tone professional and non-definitive.'
        ].join('\n'),
        letter: [
          'Dear Tenant,',
          '',
          'This notice concerns non-payment of rent for the premises at 45 Market Street, Singapore.',
          'Under the Tenancies and Property Act 1970 s 21(4), you must vacate within 7 days.',
          'Please arrange handover with our office.',
          '',
          'Regards,',
          'Property Manager'
        ].join('\n'),
        hint: 'Look for hallucinated or outdated statutes (wrong title/section).',
        options: [
          'A) It correctly cites present-day Singapore tenancy legislation.',
          'B) It uses absolute language (“guarantee”) about an uncertain legal outcome.',
          'C) It redacts all personal and sensitive details appropriately.',
          'D) It cites a non-existent or wrong-jurisdiction statute for Singapore.'
        ],
        correct: 'D',
        question: 'Which legal reference error did the AI commit?',
        risks: {
          badge: 'Medium',
          summary: [
            'Cites non‑existent/wrong‑jurisdiction statute for Singapore tenancy.',
            'May mislead tenant on legal basis for eviction timeline.'
          ],
          pii: [
            'No PII displayed — keep it that way.'
          ],
          hallucination: [
            'Cross‑check statute name/section; cite correct SG source or contract clause.'
          ]
        }
      },
      // 3) Foreign law misuse (Correct: A) — PII removed to keep single-issue clarity
      {
        prompt: [
          'Draft a landlord demand letter reminding a tenant of repairs obligations under the lease.',
          'Avoid citing foreign or outdated authorities. Prefer cautious language (“may”, “subject to”).'
        ].join('\n'),
        letter: [
          'Dear Tenant,',
          '',
          'Per Section 14 of the UK Landlord and Tenant Act 1985, you are strictly liable to repair immediately.',
          'Please fix the issues within 7 days.',
          '',
          'Sincerely,',
          'Landlord'
        ].join('\n'),
        hint: 'Watch for foreign-jurisdiction citation (UK) that does not apply in Singapore.',
        options: [
          'A) It relies on a UK statute not applicable to Singapore.',
          'B) It perfectly avoids any PII.',
          'C) It cautiously avoids guaranteeing outcomes.',
          'D) It properly cites the Singapore contract clause only.'
        ],
        correct: 'A',
        question: 'Why is this AI‑generated demand letter problematic?',
        risks: {
          badge: 'Medium',
          summary: [
            'Relies on UK statute as if binding in Singapore.',
            'Uses strong liability language that may be overstated.'
          ],
          pii: [
            'No PII present.'
          ],
          hallucination: [
            'Replace with relevant Singapore clause/statute or cite the contract.',
            'Prefer cautious phrasing (may/subject to clause).' 
          ]
        }
      },
      // 4) Outdated temporary legislation (Correct: C)
      {
        prompt: [
          'Draft a rent relief reminder for a commercial tenant in Singapore.',
          'Ensure any legislation referenced is currently in force.'
        ].join('\n'),
        letter: [
          'Dear Tenant,',
          '',
          'You remain eligible for relief under Part 2 of the COVID‑19 (Temporary Measures) Act, which is currently in force for rental waivers.',
          'Please apply by completing the attached form.',
          '',
          'Sincerely,',
          'Landlord'
        ].join('\n'),
        hint: 'Check whether temporary COVID‑19 relief provisions are still active.',
        options: [
          'A) It uses cautious and conditional phrasing.',
          'B) It avoids personal identifiers entirely.',
          'C) It cites a temporary provision that has expired/ceased to apply.',
          'D) It limits itself to contract-based remedies without statutory references.'
        ],
        correct: 'C',
        question: 'What is the flaw in citing legislation here?',
        risks: {
          badge: 'Medium',
          summary: [
            'Cites temporary COVID‑19 relief that may have expired.',
            'Risk of giving incorrect eligibility guidance.'
          ],
          pii: [
            'No PII present.'
          ],
          hallucination: [
            'Confirm whether relief remains in force; if not, remove.',
            'Offer contract‑based alternatives if statute is expired.'
          ]
        }
      },
      // 5) Over‑definitive promises (Correct: A)
      {
        prompt: [
          'Draft a notice of breach for late rent payment.',
          'Use measured language and avoid guaranteeing litigation outcomes.'
        ].join('\n'),
        letter: [
          'Dear Tenant,',
          '',
          'This letter serves as notice of breach for persistent late payment.',
          'We will obtain a court order for possession and costs next week.',
          '',
          'Sincerely,',
          'Property Manager'
        ].join('\n'),
        hint: 'Absolute predictions about litigation outcomes are risky.',
        options: [
          'A) It guarantees a litigation outcome (“We will obtain a court order”).',
          'B) It avoids all personal data.',
          'C) It cites only the contract clause without statute.',
          'D) It provides a reasonable compliance window.'
        ],
        correct: 'A',
        question: 'Which drafting issue stands out in this notice?',
        risks: {
          badge: 'High',
          summary: [
            'Guarantees litigation outcome (“We will obtain a court order”).',
            'May be construed as threatening/overreaching.'
          ],
          pii: [
            'No PII present.'
          ],
          hallucination: [
            'Use conditional language; outcomes depend on facts and court discretion.',
            'Provide compliant timelines/cure options per contract.'
          ]
        }
      },
      // 6) Hallucinated contract clause (Correct: D)
      {
        prompt: [
          'Draft a reminder to comply with the repair obligations under the Tenancy Agreement.',
          'If you cite a clause, ensure the clause exists in the provided contract.'
        ].join('\n'),
        letter: [
          'Dear Tenant,',
          '',
          'Under Clause 18.7 of your Tenancy Agreement, you must replace the air‑conditioning within 24 hours.',
          'Please confirm completion by tomorrow.',
          '',
          'Sincerely,',
          'Landlord'
        ].join('\n'),
        hint: 'Be wary of fabricating clause numbers not verified in the provided contract.',
        options: [
          'A) It correctly references the Building Maintenance and Strata Management Act.',
          'B) It refrains from using any legal references.',
          'C) It provides an appropriate and realistic timeline.',
          'D) It appears to invent a contract clause number that may not exist (hallucination).'
        ],
        correct: 'D',
        question: 'What possible contract clause issue is present?',
        risks: {
          badge: 'Medium',
          summary: [
            'Appears to invent a contract clause number that may not exist.',
            'Creates enforcement risk if relied on.'
          ],
          pii: [
            'No PII present.'
          ],
          hallucination: [
            'Open the Tenancy Agreement and verify clause numbering/wording.',
            'Align deadlines with the contract and reasonableness.'
          ]
        }
      }
    ];
    window.__letterScenarios = scenarios;

    let idx = 0;
    window.__letterIdx = idx;

    function render(i) {
      const sc = scenarios[i];
      // Update MCQ heading
      if (questionHeading) questionHeading.textContent = sc.question;
      // Update prompt and letter
      if (promptPre) promptPre.textContent = sc.prompt;
      if (letterPre) letterPre.textContent = sc.letter;
      if (hintDetails) {
        // keep summary label as-is; update body text after it
        const nodes = Array.from(hintDetails.childNodes);
        const bodyNode = nodes.find(n => n.nodeType === Node.TEXT_NODE || (n.nodeType === Node.ELEMENT_NODE && n.tagName !== 'SUMMARY'));
        // Replace inner text after <summary> with hint string
        // Simplest: set the hintDetails innerHTML preserving <summary>
        if (hintSummary) {
          hintDetails.innerHTML = '';
          hintDetails.appendChild(hintSummary);
          const text = document.createTextNode(' ' + sc.hint);
          hintDetails.appendChild(text);
        }
      }
      // Update options
      options.forEach((label, j) => {
        const input = label.querySelector('input[type="radio"]');
        if (input) { input.checked = false; input.setAttribute('aria-checked', 'false'); }
        const textNode = label.childNodes[label.childNodes.length - 1];
        if (textNode && textNode.nodeType === Node.TEXT_NODE) {
          textNode.nodeValue = ' ' + sc.options[j];
        } else {
          // fallback: set entire label text after input
          label.innerHTML = label.querySelector('input').outerHTML + ' ' + sc.options[j];
        }
      });
      // Stash correct answer for any custom logic; harmless if unused by existing scripts
      form.dataset.correct = sc.correct;
      // Update progress indicator and bar
      if (progressText) progressText.textContent = `Question ${i + 1} of ${scenarios.length}`;
      if (progressFill) progressFill.style.width = `${Math.round((i / scenarios.length) * 100)}%`;
      // Reset risk coaching when switching questions
      if (badgeEl) {
        badgeEl.textContent = '–';
        badgeEl.className = 'badge'; // reset to base class, removes colour styling
      }
      if (riskSummaryList) riskSummaryList.innerHTML = '';
      if (piiList) piiList.innerHTML = '';
      if (hallucinationList) hallucinationList.innerHTML = '';
      if (risk) risk.hidden = true;
      // Reset feedback and risk panels
      if (feedback) feedback.textContent = '';
      // Move focus for accessibility
    
    }

    // Grade strictly against the scenario key and block any legacy handlers
    form.addEventListener('submit', function (e) {
      e.preventDefault();
      e.stopImmediatePropagation();
      const selected = form.querySelector('input[type="radio"]:checked');
      const key = (form.dataset.correct || '').trim();
      const ok = !!selected && (!!key ? selected.value === key : false);
      if (feedback) {
        feedback.textContent = ok
          ? '✅ Correct'
          : '❌ Not quite — try again or open Risk Coaching.';
      }
    }, true);

    // Show Risk Coaching: populate from current scenario risks
    const showBtn = form.querySelector('[data-show-analysis]');
    function fillList(ul, items) {
      if (!ul) return;
      ul.innerHTML = '';
      (items || []).forEach(t => {
        const li = document.createElement('li');
        li.textContent = t;
        ul.appendChild(li);
      });
    }
    if (showBtn) {
      showBtn.addEventListener('click', function () {
        const sc = window.__letterScenarios ? window.__letterScenarios[window.__letterIdx] : scenarios[idx];
        if (!sc || !sc.risks) { if (risk) risk.hidden = false; return; }
        if (badgeEl) {
          badgeEl.textContent = sc.risks.badge || '–';
          // Optional colour: add class based on badge severity
          badgeEl.className = 'badge ' + ((sc.risks.badge === 'High') ? 'warn' : 'info');
        }
        fillList(riskSummaryList, sc.risks.summary);
        fillList(piiList, sc.risks.pii);
        fillList(hallucinationList, sc.risks.hallucination);
        if (risk) risk.hidden = false;
      });
    }

    if (nextBtn) {
      nextBtn.addEventListener('click', function () {
        idx = (idx + 1) % scenarios.length;
        window.__letterIdx = idx;
        render(idx);
        // Ensure previous risk panel does not persist to next question
        if (badgeEl) {
          badgeEl.textContent = '–';
          badgeEl.className = 'badge';
        }
        if (riskSummaryList) riskSummaryList.innerHTML = '';
        if (piiList) piiList.innerHTML = '';
        if (hallucinationList) hallucinationList.innerHTML = '';
        if (risk) risk.hidden = true;
        // Announce change
        if (feedback) feedback.setAttribute('aria-live', 'polite');
      });
    }

    // Initial render ensures dataset.correct is set for scenario 0
    render(idx);
    if (risk) risk.hidden = true;
  })();
  </script>
</body>
</html>
